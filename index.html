<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Galactic RP Map</title>

<style>

body {
margin:0;
font-family:Arial;
color:white;
background-image:url("static/background.jpg");
background-size:cover;
background-attachment:fixed;
background-color:#050814;
}

h2 { text-align:center; }

/* MAP */

#map-container{
position:relative;
width:900px;
max-width:95vw;
aspect-ratio:16/9;
margin:20px auto;
background:#081224;
border-radius:12px;
border:1px solid rgba(0,150,255,.4);
overflow:hidden;
cursor:grab;
}

#map-world{
position:absolute;
width:100%;
height:100%;
}

/* PLANETS */

.planet{
position:absolute;
transform:translate(-50%,-50%);
}

.dot{
width:12px;
height:12px;
border-radius:50%;
cursor:pointer;
}

/* FACTIONS */

.republic .dot{background:#4db8ff;box-shadow:0 0 8px #4db8ff;}
.empire .dot{background:#ff2b2b;box-shadow:0 0 8px #ff2b2b;}
.neutral .dot{background:#cccccc;box-shadow:0 0 6px #ccc;}
.pirates .dot{background:#9c27ff;box-shadow:0 0 6px #9c27ff;}

/* LABEL */

.label{
margin-top:6px;
font-size:11px;
background:rgba(0,0,0,.7);
padding:3px 6px;
border-radius:5px;
white-space:nowrap;
}

/* INFO */

#info{
width:900px;
max-width:95vw;
margin:15px auto;
padding:12px;
background:#081a35;
border-radius:10px;
}

/* ROUTES */

#routes-layer{
position:absolute;
width:100%;
height:100%;
pointer-events:none;
}

.route-line{
stroke:rgba(0,170,255,.5);
stroke-width:.7;
}

/* BUTTON */

#route-toggle{
position:absolute;
top:10px;
right:10px;
padding:6px 10px;
background:#0a2a55;
border-radius:8px;
cursor:pointer;
}

</style>
</head>

<body>

<h2>Galactic RP Map</h2>

<div id="map-container">

<div id="route-toggle">Routes : ON</div>

<div id="map-world">

<svg id="routes-layer"></svg>

</div>
</div>

<div id="info">Click on a planet</div>

<script>

/* CAMERA */

let scale=1,posX=0,posY=0;
const world=document.getElementById("map-world");
const viewport=document.getElementById("map-container");

function updateTransform(){
world.style.transform=`translate(${posX}px,${posY}px) scale(${scale})`;
}

viewport.addEventListener("wheel",e=>{
e.preventDefault();
scale+=e.deltaY<0?0.1:-0.1;
scale=Math.max(.6,Math.min(2.5,scale));
updateTransform();
},{passive:false});

/* ROUTES */

const routesSVG=document.getElementById("routes-layer");

function buildRoutes(){

routesSVG.innerHTML="";

const planets=document.querySelectorAll(".planet");
const rectMap=viewport.getBoundingClientRect();

const points=[];

planets.forEach(p=>{
const r=p.getBoundingClientRect();
points.push({
x:r.left+r.width/2-rectMap.left,
y:r.top+r.height/2-rectMap.top
});
});

for(let i=0;i<points.length;i++){
for(let j=i+1;j<points.length;j++){

const dx=points[i].x-points[j].x;
const dy=points[i].y-points[j].y;
const dist=Math.sqrt(dx*dx+dy*dy);

if(dist<220){

const line=document.createElementNS("http://www.w3.org/2000/svg","line");
line.setAttribute("x1",points[i].x);
line.setAttribute("y1",points[i].y);
line.setAttribute("x2",points[j].x);
line.setAttribute("y2",points[j].y);
line.classList.add("route-line");
routesSVG.appendChild(line);
}
}
}

}

/* INFO PANEL */

function selectPlanet(el){

const planet=el.closest(".planet");

document.getElementById("info").innerHTML=`
<h3>${planet.dataset.name}</h3>
<b>Faction:</b> ${planet.dataset.faction}<br><br>
${planet.dataset.desc}<br><br>
<a href="${planet.dataset.wiki}" target="_blank">Open Wiki</a>
`;

}

/* ROUTE TOGGLE */

let routesVisible=true;

document.getElementById("route-toggle").onclick=()=>{

routesVisible=!routesVisible;
routesSVG.style.display=routesVisible?"block":"none";

};

/* LOAD DATA */

fetch("data.json")
.then(r=>r.json())
.then(planetes=>{

planetes.forEach(p=>{

const div=document.createElement("div");

div.className="planet "+p.Faction.toLowerCase();
div.style.left=p.X+"%";
div.style.top=p.Y+"%";

div.dataset.name=p.Planete;
div.dataset.faction=p.Faction;
div.dataset.desc=p.Description;
div.dataset.wiki=p.Wiki;

div.innerHTML=`
<div class="dot" onclick="selectPlanet(this)"></div>
<div class="label">${p.Planete}</div>
`;

world.appendChild(div);

});

buildRoutes();

});

</script>

</body>
</html>
